# Flai Agent

AIå¯¹è¯ä»£ç†æœåŠ¡ï¼ŒåŸºäºFastAPIæ„å»ºï¼Œæ”¯æŒå¤šè§’è‰²å¯¹è¯ã€æƒ…ç»ªåˆ†æã€è¯­éŸ³åˆæˆç­‰åŠŸèƒ½ã€‚

## ğŸ“‹ åŠŸèƒ½ç‰¹æ€§

- ğŸ¤– å¤šè§’è‰²AIå¯¹è¯ç³»ç»Ÿ
- ğŸ§  **é•¿çŸ­æœŸè®°å¿†**ï¼ˆæ”¯æŒè¯­ä¹‰æ£€ç´¢ï¼‰
- ğŸ˜Š æ™ºèƒ½æƒ…ç»ªè¯†åˆ«ä¸åˆ†æ
- ğŸ”Š æ–‡å­—è½¬è¯­éŸ³ï¼ˆTTSï¼‰
- ğŸ´ å åœæŠ½å¡åŠŸèƒ½
- ğŸ›¡ï¸ æ•æ„Ÿå†…å®¹è¿‡æ»¤
- ğŸ’¾ å¯¹è¯å†å²è®°å½•
- â˜ï¸ OSSäº‘å­˜å‚¨é›†æˆ
- ğŸ”¥ é…ç½®çƒ­æ›´æ–°

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. ç¯å¢ƒè¦æ±‚

- Python 3.8+
- MySQL æ•°æ®åº“
- é˜¿é‡Œäº‘OSSï¼ˆç”¨äºè¯­éŸ³æ–‡ä»¶å­˜å‚¨ï¼‰
- Qdrant å‘é‡æ•°æ®åº“ï¼ˆå¯é€‰ï¼Œç”¨äºé•¿æœŸè®°å¿†åŠŸèƒ½ï¼‰

### 2. ä½¿ç”¨ UV æ„å»ºç¯å¢ƒ

**å®‰è£… UV**ï¼š
```bash
curl -LsSf https://astral.sh/uv/install.sh | sh
```

**åˆ›å»ºè™šæ‹Ÿç¯å¢ƒå¹¶å®‰è£…ä¾èµ–**ï¼š
```bash
# åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ
uv venv

# æ¿€æ´»ç¯å¢ƒ
source .venv/bin/activate  # Linux/macOS
# æˆ– .venv\Scripts\activate  # Windows

# å®‰è£…ä¾èµ–
uv pip install -r requirements.txt
```

### 3. é…ç½®æ–‡ä»¶

```bash
# å¤åˆ¶é…ç½®æ¨¡æ¿
cp config/config.yaml.example src/config.yaml

# ç¼–è¾‘é…ç½®æ–‡ä»¶ï¼Œå¡«å…¥å®é™…çš„æ•°æ®åº“ã€APIå¯†é’¥ç­‰ä¿¡æ¯
vim src/config.yaml
```

### 4. å¯åŠ¨é¡¹ç›®

**å¼€å‘æ¨¡å¼ï¼ˆæ¨èï¼‰**ï¼š
```bash
# æ–¹å¼1ï¼šUV è‡ªåŠ¨ç®¡ç†ç¯å¢ƒï¼ˆæ— éœ€æ‰‹åŠ¨æ¿€æ´»ï¼‰
uv run uvicorn src.main:app --reload --host 0.0.0.0 --port 8000

# æ–¹å¼2ï¼šæ¿€æ´»ç¯å¢ƒåè¿è¡Œ
source .venv/bin/activate
uvicorn src.main:app --reload --host 0.0.0.0 --port 8000
```

**ç”Ÿäº§æ¨¡å¼ï¼ˆåå°è¿è¡Œï¼‰**ï¼š
```bash
source .venv/bin/activate
nohup uvicorn src.main:app --host 0.0.0.0 --port 8000 > logs/app.log 2>&1 &
```

**è®¿é—®æœåŠ¡**ï¼š
- API æ–‡æ¡£ï¼šhttp://localhost:8000/docs
- äº¤äº’å¼æ–‡æ¡£ï¼šhttp://localhost:8000/redoc

## ğŸ“ é¡¹ç›®ç»“æ„

```
flai_agent/
â”œâ”€â”€ config/                    # é…ç½®æ–‡ä»¶
â”‚   â”œâ”€â”€ prompts/              # Prompté…ç½®ï¼ˆJSONæ ¼å¼ï¼Œæ”¯æŒçƒ­æ›´æ–°ï¼‰
â”‚   â”‚   â”œâ”€â”€ characters.json   # è§’è‰²ç³»ç»Ÿé…ç½®
â”‚   â”‚   â”œâ”€â”€ character_openers.json  # è§’è‰²å¼€åœºç™½
â”‚   â”‚   â”œâ”€â”€ emotions.json     # æƒ…ç»ªé…ç½®
â”‚   â”‚   â”œâ”€â”€ responses.json    # å›å¤é…ç½®
â”‚   â”‚   â””â”€â”€ constants.json    # å¸¸é‡é…ç½®
â”‚   â””â”€â”€ config.yaml.example   # é…ç½®æ¨¡æ¿
â”œâ”€â”€ data/                      # æ•°æ®æ–‡ä»¶
â”‚   â””â”€â”€ sensitive_words.txt   # æ•æ„Ÿè¯åˆ—è¡¨
â”œâ”€â”€ logs/                      # è¿è¡Œæ—¶æ—¥å¿—ï¼ˆæŒ‰å‘¨åˆ’åˆ†ï¼ŒæŒ‰æœˆå½’æ¡£ï¼‰
â”‚   â”œâ”€â”€ 2025-10/              # 2025å¹´10æœˆçš„æ—¥å¿—
â”‚   â”‚   â””â”€â”€ 2025-10-27_2025-11-02.log
â”‚   â””â”€â”€ 2025-11/              # 2025å¹´11æœˆçš„æ—¥å¿—
â”‚       â””â”€â”€ 2025-11-03_2025-11-09.log
â”œâ”€â”€ scripts/                   # å·¥å…·è„šæœ¬
â”‚   â”œâ”€â”€ log_extractor.py      # æ—¥å¿—æå–å·¥å…·
â”‚   â””â”€â”€ log_extractor.sh
â”œâ”€â”€ src/                       # æºä»£ç 
â”‚   â”œâ”€â”€ api/                  # APIå±‚
â”‚   â”‚   â””â”€â”€ routes.py         # APIè·¯ç”±å®šä¹‰
â”‚   â”œâ”€â”€ core/                 # æ ¸å¿ƒä¸šåŠ¡é€»è¾‘
â”‚   â”‚   â”œâ”€â”€ config_loader.py  # é…ç½®åŠ è½½å™¨ï¼ˆæ”¯æŒçƒ­æ›´æ–°ï¼‰
â”‚   â”‚   â”œâ”€â”€ content_filter.py # å†…å®¹è¿‡æ»¤
â”‚   â”‚   â””â”€â”€ dialogue_query.py # å¯¹è¯æŸ¥è¯¢
â”‚   â”œâ”€â”€ services/             # ç¬¬ä¸‰æ–¹æœåŠ¡
â”‚   â”‚   â”œâ”€â”€ oss_client.py     # OSSå®¢æˆ·ç«¯
â”‚   â”‚   â””â”€â”€ speech_api.py     # è¯­éŸ³API
â”‚   â”œâ”€â”€ database.py           # æ•°æ®åº“é…ç½®
â”‚   â”œâ”€â”€ schemas.py            # æ•°æ®æ¨¡å‹
â”‚   â”œâ”€â”€ utils.py              # å·¥å…·å‡½æ•°
â”‚   â”œâ”€â”€ custom_logger.py      # æ—¥å¿—é…ç½®
â”‚   â””â”€â”€ main.py               # åº”ç”¨å…¥å£
â”œâ”€â”€ pyproject.toml            # é¡¹ç›®é…ç½®
â”œâ”€â”€ requirements.txt          # ä¾èµ–åˆ—è¡¨
â””â”€â”€ .gitignore
```

## ğŸ”§ API æ–‡æ¡£

å¯åŠ¨æœåŠ¡åï¼Œè®¿é—® Swagger æ–‡æ¡£æŸ¥çœ‹æ‰€æœ‰ API æ¥å£çš„è¯¦ç»†ä½¿ç”¨æ–¹æ³•ï¼š

- **Swagger UI**ï¼šhttp://localhost:8000/docs
- **ReDoc**ï¼šhttp://localhost:8000/redoc

## ğŸ› ï¸ å¼€å‘è¯´æ˜

### æ¶æ„è¯´æ˜

é¡¹ç›®é‡‡ç”¨åˆ†å±‚æ¶æ„ï¼š
- **APIå±‚**ï¼ˆ`routes.py`ï¼‰- çº¯è·¯ç”±å®šä¹‰ï¼Œå‚æ•°éªŒè¯
- **æœåŠ¡å±‚**ï¼ˆ`services/`ï¼‰- ä¸šåŠ¡é€»è¾‘ï¼ŒLLMè°ƒç”¨
- **æ ¸å¿ƒå±‚**ï¼ˆ`core/`ï¼‰- é€šç”¨åŠŸèƒ½ï¼Œæ•°æ®æŸ¥è¯¢
- **é…ç½®å±‚**ï¼ˆ`config/`ï¼‰- JSONé…ç½®ï¼Œæ”¯æŒçƒ­æ›´æ–°

### ä¸‰å±‚è®°å¿†ç³»ç»Ÿ

æœ¬é¡¹ç›®å®ç°æ™ºèƒ½çš„ä¸‰å±‚è®°å¿†æ¶æ„ï¼š

1. **å¯¹è¯å†å²**ï¼ˆMySQLï¼‰- æœ€è¿‘7è½®å¯¹è¯ï¼Œä¿æŒè¿è´¯æ€§
2. **æŒä¹…åŒ–è®°å¿†**ï¼ˆMySQL chat_memoryè¡¨ï¼‰- LLMè‡ªåŠ¨æå–ç”¨æˆ·ç‰¹å¾
   - çŸ­æœŸè®°å¿†ï¼šæœ€è¿‘äº‹ä»¶ï¼ˆ"æˆ‘æ˜¨å¤©åƒäº†ç«é”…"ï¼‰â†’ 10è½®æ‰¹é‡æ›´æ–°
   - é•¿æœŸè®°å¿†ï¼šç”¨æˆ·åå¥½ï¼ˆ"æˆ‘å–œæ¬¢åƒè¾£çš„"ï¼‰â†’ ç«‹å³æ›´æ–°
3. **é¢å¤–è®°å¿†**ï¼ˆQdrantï¼Œå¯é€‰ï¼‰- è¯­ä¹‰ç›¸ä¼¼çš„å†å²å¯¹è¯æ£€ç´¢

**é…ç½®ç¤ºä¾‹**ï¼š
```yaml
# æŒä¹…åŒ–è®°å¿†ï¼ˆé»˜è®¤å¯ç”¨ï¼‰
persistent_memory:
  enabled: true
  short_term_update_interval: 10
  enabled_characters: []  # ç©º=å…¨éƒ¨å¯ç”¨ï¼Œæˆ–æŒ‡å®šè§’è‰²

# å‘é‡æ£€ç´¢ï¼ˆå¯é€‰ï¼‰
vector_db:
  enabled: false  # æ”¹ä¸º true å¯ç”¨
```

### é…ç½®çƒ­æ›´æ–°

é…ç½®æ–‡ä»¶æ”¯æŒçƒ­æ›´æ–°ï¼Œä¿®æ”¹ä»¥ä¸‹æ–‡ä»¶åä¼šè‡ªåŠ¨ç”Ÿæ•ˆï¼Œæ— éœ€é‡å¯æœåŠ¡ï¼š
- `config/prompts/*.json` - æ‰€æœ‰ Prompt é…ç½®
- `data/sensitive_words.txt` - æ•æ„Ÿè¯åˆ—è¡¨

### æ·»åŠ æ–°è§’è‰²

ç¼–è¾‘ `config/prompts/characters.json` å’Œ `config/prompts/character_openers.json`ï¼Œæ·»åŠ æ–°çš„è§’è‰²é…ç½®ã€‚

### æ—¥å¿—ç®¡ç†

æ—¥å¿—æŒ‰å‘¨åˆ’åˆ†ï¼Œè‡ªåŠ¨æŒ‰æœˆå½’æ¡£åˆ°æ–‡ä»¶å¤¹ï¼š
- **æ–‡ä»¶å¤¹**ï¼š`logs/YYYY-MM/` (æŒ‰å¼€å§‹æ—¥æœŸçš„æœˆä»½)
- **æ–‡ä»¶å**ï¼š`YYYY-MM-DD_YYYY-MM-DD.log` (å‘¨ä¸€åˆ°å‘¨æ—¥)
- **è‡ªåŠ¨æ¸…ç†**ï¼šè¶…è¿‡6ä¸ªæœˆçš„æ—¥å¿—ä¼šåœ¨æœåŠ¡å¯åŠ¨æ—¶è‡ªåŠ¨æ¸…ç†

ç¤ºä¾‹ï¼š
```
logs/
â”œâ”€â”€ 2025-10/
â”‚   â””â”€â”€ 2025-10-27_2025-11-02.log  (è·¨æœˆçš„å‘¨ï¼ŒæŒ‰å¼€å§‹æ—¥æœŸå½’æ¡£åˆ°10æœˆ)
â””â”€â”€ 2025-11/
    â””â”€â”€ 2025-11-03_2025-11-09.log
```

æŸ¥çœ‹æ—¥å¿—ï¼š
```bash
# æŸ¥çœ‹å½“å‰å‘¨çš„æ—¥å¿—
tail -f logs/$(date +%Y-%m)/*.log

# æˆ–æŸ¥çœ‹æœ€æ–°çš„æ—¥å¿—æ–‡ä»¶
tail -f $(ls -t logs/*/*.log | head -1)

# æå–æŒ‡å®šæ—¶é—´æ®µæ—¥å¿—
./scripts/log_extractor.sh "2025-11-04 10:00" "2025-11-04 11:00" logs/2025-11/*.log
```

### å¸¸ç”¨å‘½ä»¤

```bash
# æ·»åŠ æ–°ä¾èµ–
source .venv/bin/activate
uv pip install package-name
pip freeze > requirements.txt

# æŸ¥çœ‹å·²å®‰è£…çš„åŒ…
source .venv/bin/activate
pip list
```

## ğŸ“ è®¸å¯è¯

æœ¬é¡¹ç›®ä¸ºä¸ªäººé¡¹ç›®ã€‚
